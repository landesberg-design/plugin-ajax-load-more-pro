(()=>{"use strict";jQuery(document).ready((function(e){var t=t||{},a={array:window.alm_cache_array,elapsed:document.querySelector("#alm-elapsed-time"),iframe:document.querySelector(".iframe-target"),list:document.querySelector("ul.alm-generate-cache--list"),initBtn:document.querySelector("button.button-alm-generate-cache"),pauseBtn:document.querySelector(".alm-generate-cache--controls .cache-pause"),resumeBtn:document.querySelector(".alm-generate-cache--controls .cache-resume"),rebuildBtn:document.querySelector(".alm-generate-cache--controls .cache-rebuild"),txtProcessing:document.querySelector("#alm-cache-processing-txt"),txtPaused:document.querySelector("#alm-cache-paused-txt"),txtComplete:document.querySelector("#alm-cache-complete-txt"),dircount:0,filecount:0,pause:!1,timer:null,elapsed_timer:null,elapsed_counter:0,current:0};t.countRecords=function(e,t){document.querySelector("#dircount").innerHTML=e,document.querySelector("#filecount").innerHTML=t};var n=0,c=0,l=0;t.elapsedTime=function(){a.elapsed_timer=setInterval((function(){++n>=60&&(n=0,++c>=60&&(c=0,l++)),e("span",a.elapsed).text((l?l>9?l:"0"+l:"00")+":"+(c?c>9?c:"0"+c:"00")+":"+(n>9?n:"0"+n))}),1e3)},t.buildCache=function(){if(clearInterval(a.timer),a.current<alm_cache_array.length){var e=a.array[a.current].max?a.array[a.current].max:9999;t.setIframeSrc(a.array[a.current].url,a.array[a.current].id,e)}else t.complete()},t.setCurrent=function(){e("li",a.list).eq(a.current).addClass("current")},t.cacheItemBuilt=function(t,n){n?e("li",a.list).eq(t).removeClass("current").addClass("done"):e("li",a.list).eq(t).removeClass("current").addClass("doneError")},t.complete=function(){a.txtProcessing.style.display="none",a.txtPaused.style.display="none",a.txtComplete.style.display="block",a.pauseBtn.style.display="none",a.resumeBtn.style.display="none",a.rebuildBtn.style.display="block",a.current=0,clearInterval(a.elapsed_timer),clearInterval(a.timer)},t.pause=function(){a.pause=!0,a.txtProcessing.style.display="none",a.txtPaused.style.display="block",a.txtComplete.style.display="none",a.pauseBtn.style.display="none",a.resumeBtn.style.display="block",e("li",a.list).eq(a.current).removeClass("current"),clearInterval(a.elapsed_timer)},t.resume=function(){a.pause=!1,a.txtProcessing.style.display="block",a.txtPaused.style.display="none",a.txtComplete.style.display="none",a.pauseBtn.style.display="block",a.resumeBtn.style.display="none",e("li",a.list).eq(a.current).addClass("current"),t.elapsedTime()},t.setIframeSrc=function(n,c,l){e(a.iframe).html(""),e(a.iframe).append(e('<iframe id="myIframe" width="100%"></iframe>')),e("iframe",a.iframe).attr("src",n+"?alm_auto_cache=true"),e("iframe",a.iframe).on("load",(function(){t.setCurrent(),t.iframeLoaded(e("iframe",a.iframe).get(0),c,l)}))},t.iframeLoaded=function(e,n,c){var l=e.contentWindow.document.querySelector('.alm-listing[data-cache-id="'+n+'"]'),r=0;if(l){var i=l.parentNode.querySelector(".alm-load-more-btn");a.timer=setInterval((function(){a.pause||(i.classList.contains("done")||r>c?(t.cacheItemBuilt(a.current,!0),a.current++,t.buildCache(),a.dircount++,t.countRecords(a.dircount,a.filecount)):i.classList.contains("loading")||(a.filecount++,r++,i.click(),t.countRecords(a.dircount,a.filecount)))}),1500)}else t.cacheItemBuilt(a.current,!1),a.current++,t.buildCache()},a.initBtn&&a.initBtn.addEventListener("click",(function(){window.location="admin.php?page=ajax-load-more-cache&action=build"})),a.array&&a.iframe&&(t.buildCache(),t.elapsedTime(),a.txtProcessing.style.display="block"),a.pauseBtn&&(a.resumeBtn.style.display="none",a.pauseBtn.addEventListener("click",t.pause),a.resumeBtn.addEventListener("click",t.resume)),a.rebuildBtn&&a.rebuildBtn.addEventListener("click",(function(){location.reload()})),e(".alm-cache-search-wrap input").keyup((function(){var t=e.trim(e(this).val());""!==t?e(".alm-dir-listing").each((function(a){var n=e(this);e("h3.dir-title",n).text().match(t)||e("ul.cache-details a",n).text().match(t)?n.show():n.hide()})):e(".alm-dir-listing").show()})),t.deleteCache=function(t,a,n){e.ajax({type:"POST",url:alm_cache_localize.ajax_admin_url,data:{action:"alm_delete_cache",cache:t,nonce:alm_cache_localize.alm_cache_nonce},success:function(){var t=n.height()>500?450:300;n.slideUp(t,(function(){n.removeClass("deleting").remove(),0===e(".alm-dir-listing").length&&(window.location="admin.php?page=ajax-load-more-cache"),console.log("Ajax Load More Cache successfully deleted.")}))},error:function(e,t,a){alert("The was an error and the cache could not be deleted.")}})},e(document).on("click",".alm-dir-listing .delete",(function(a){var n=e(this),c=n.data("id"),l=n.data("path"),r=n.closest(".alm-dir-listing"),i=window.alm_cache_localize.are_you_sure+"\n"+l;1!=confirm(i)||e(this).hasClass("deleting")?(a.stopPropagation(),a.preventDefault()):(a.stopPropagation(),r.addClass("deleting"),t.deleteCache(c,n,r))})),e(document).on("click","form#delete-all-cache button",(function(t){var a=e("form#delete-all-cache"),n=a.data("path"),c=window.alm_cache_localize.are_you_sure_full+"\n"+n;confirm(c)?a.addClass("deleting"):t.preventDefault()})),e("button.cache-full-path-button").on("click",(function(){e(this).next("span").css("display","inline"),e(this).hide()}))}))})();